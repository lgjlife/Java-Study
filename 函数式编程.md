
<h1>函数式编程</h1>

<span id="menu"></span>

<!-- TOC -->

- [1. 什么是函数式编程](#1-什么是函数式编程)
  - [1.1. 什么是函数式编程](#11-什么是函数式编程)
  - [1.2. 函数式编程的特性](#12-函数式编程的特性)
  - [1.3. 函数式编程的优点](#13-函数式编程的优点)
- [2. 在Java中使用函数](#2-在java中使用函数)
  - [2.1. 函数式的方法](#21-函数式的方法)
- [3. 让Java更加函数化](#3-让java更加函数化)

<!-- /TOC -->

# 1. 什么是函数式编程
<a href="#menu"  >目录</a>

## 1.1. 什么是函数式编程
<a href="#menu"  >目录</a>

我们最常用的面向对象编程（Java）属于命令式编程（Imperative Programming）这种编程范式。常见的编程范式还有逻辑式编程（Logic Programming），函数式编程（Functional Programming）。

什么是函数式编程？简单的回答：一切都是数学函数。函数式编程语言里也可以有对象，但通常这些对象都是恒定不变的 —— 要么是函数参数，要什么是函数返回值。函数式编程语言里没有 for/next 循环，因为这些逻辑意味着有状态的改变。相替代的是，这种循环逻辑在函数式编程语言里是通过递归、把函数当成参数传递的方式实现的。

命令使编程和函数式编程最大的区别是函数式编程没有副作用，意味着
* 没有变量改变
* 没有打印到控制台或者其他设备
* 没有写入文件，数据库，网络或者其他
* 没有抛出异常

但是实际上函数不可能没有副作用，比如造成内存耗尽，堆栈溢出，写内存，等等。函数式编程其实是编写非故意的副作用的程序，非故意的副作用越少越好。

所以并非某一种语言是命令式编程语言或者函数式编程语言，是哪种基于你如何编写程序。
  
```java
//符合函数式编程，java是值传递，内部的变化对外部不可变
//虽然结果可能存在溢出，但仍然是函数式的
int add(int a,int b)
{
    while(b > 0){
        a++;
        b--;
    }
    return a;
}
//当b＝０时，就会抛出异常，产生副作用，所以不是函数式
int div(int a,int b)
{
    return a/b;
}
```

函数式编程的准则：不依赖于外部的数据，而且也不改变外部数据的值，而是返回一个新的值给你。
```java
//非函数式
int cnt;
void increment(){
    cnt++;
}
//函数式
int increment(int cnt){
    return cnt+1;
}
```

函数式编程首先认识函数函数，指数学中的函数，即自变量的映射。也就是说一个函数的值仅决定于函数参数的值，不依赖其他状态。比如sqrt(x)函数计算x的平方根，只要x不变，不论什么时候调用，调用几次，值都是不变的。


## 1.2. 函数式编程的特性
<a href="#menu"  >目录</a>

* immutable data 不可变数据：像Clojure一样，默认上变量是不可变的，如果你要改变变量，你需要把变量copy出去修改。这样一来，可以让你的程序少很多Bug。因为，程序中的状态不好维护，在并发的时候更不好维护。（你可以试想一下如果你的程序有个复杂的状态，当以后别人改你代码的时候，是很容易出bug的，在并行中这样的问题就更多了）
* first class functions：这个技术可以让你的函数就像变量一样来使用。也就是说，你的函数可以像变量一样被创建，修改，并当成变量一样传递，返回或是在函数中嵌套函数。这个有点像Javascript的Prototype（参看Javascript的面向对象编程）
* 尾递归优化：我们知道递归的害处，那就是如果递归很深的话，stack受不了，并会导致性能大幅度下降。所以，我们使用尾递归优化技术——每次递归时都会重用stack，这样一来能够提升性能，当然，这需要语言或编译器的支持。Python就不支持。


## 1.3. 函数式编程的优点
<a href="#menu"  >目录</a>

* parallelization 并行：所谓并行的意思就是在并行环境下，各个线程之间不需要同步或互斥。
* lazy evaluation 惰性求值：这个需要编译器的支持。表达式不在它被绑定到变量之后就立即求值，而是在该值被取用的时候求值，也就是说，语句如x:=expression; (把一个表达式的结果赋值给一个变量)明显的调用这个表达式被计算并把结果放置到 x 中，但是先不管实际在 x 中的是什么，直到通过后面的表达式中到 x 的引用而有了对它的值的需求的时候，而后面表达式自身的求值也可以被延迟，最终为了生成让外界看到的某个符号而计算这个快速增长的依赖树。
* determinism 确定性：所谓确定性的意思就是像数学那样 f(x) = y ，这个函数无论在什么场景下，都会得到同样的结果，这个我们称之为函数的确定性。而不是像程序中的很多函数那样，同一个参数，却会在不同的场景下计算出不同的结果。所谓不同的场景的意思就是我们的函数会根据一些运行中的状态信息的不同而发生变化。

函数式编程有如下好处：
* 代码更简单了。 
* 数据集，操作，返回值都放到了一起。 
* 你在读代码的时候，没有了循环体，于是就可以少了些临时变量，以及变量倒来倒去逻辑。 
* 你的代码变成了在描述你要干什么，而不是怎么去干。
* 函数式编程就是用函数来编程 ， 返回结果 ， 没有任何副作用。
* 函数式程序容易推断，也容易测试。
* 函数式编程提供了高层次的抽象和重用 。
* 函数式程序比命令式程序更加健壮。
* 函数式程序由于避免了共享可变状态，因而在多线程环境中更加安全
* 函数式程序更加易于推断，因为它们是确定性（ deterministic ）的 。 对于一个特定的输入总会给出相同的输出。在许多情况下 ， 你都可以证明程序是正确的，而不是在大量的测试后仍然不确定程序是否会在意外的情况下出错。
* 函数式程序更加易于测试。因为没有副作用，所以你不需要那些经常用于在测试里隔离程序及外界的 mock。
* 函数式程序更加模块化，因为它们是由只有输入和输出的函数构建的。我们不必处理副作用，不必捕获异常，不必处理上下文变化 ， 不必共享变化的状态，也没有并发的修改。
* 函数式编程让复合和重新复合更加简单。为了编写函数式程序，你需要开始编写各种必要的基础函数，并把它们复合为更高级别的函数，重复这个过程直到你拥有了一个与你打算构建的程序一致的函数。因为所有的函数都是引用透明的，它们无须修改便可以为其他程序所重用。

# 2. 在Java中使用函数
<a href="#menu"  >目录</a>

## 2.1. 函数式的方法
<a href="#menu"  >目录</a>

一个方法可以是函数式的，只要它满足纯函数的要求：
* 它不能修改函数外的任何东西。外部观测不到内部的任何变化 。
* 它不能修改自己的参数 。
* 它不能抛出错误或异常 。
* 它必须返回一个值 。
* 只要调用它的参数相同，结果也必须相同,但并不意味着结果一定准确，比如溢出。


# 3. 让Java更加函数化
<a href="#menu"  >目录</a>

